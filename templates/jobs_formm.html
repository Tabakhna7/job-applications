<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>طلب توظيف - فوكس فلسطين</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        #ageError {
            color: red;
            display: none;
            font-size: 0.9em;
            margin-top: 5px;
        }
    </style>
</head>
<body>

<!-- Loading Page -->
<div id="loadingScreen">
    <img src="{{ url_for('static', filename='fox.jpg') }}" class="loading-img">
    <p>...Loading</p>
</div>

<div class="form-container" id="formContainer" style="display:none;">
    <!-- العنوان + الشعار -->
    <h1 class="form-title">طلب توظيف - فوكس فلسطين</h1>
    <img src="{{ url_for('static', filename='fox.jpg') }}" alt="شعار الشركة" class="logo">

    {% if submitted == 'true' %}
    <div class="success-popup">
        <h2>✅ تم إرسال طلبك بنجاح!</h2>
    </div>
    {% else %}
    <form id="multiStepForm" method="POST">
        <div class="progressbar">
            <div class="progress" id="progress"></div>
            <div class="progress-step active" data-title="1">1</div>
            <div class="progress-step" data-title="2">2</div>
            <div class="progress-step" data-title="3">3</div>
        </div>

        <!-- الخطوة 1 -->
        <div class="form-step active">
            <input type="text" name="name" placeholder="الاسم الكامل" required>
            
            <div>
                <input type="number" name="age" placeholder="العمر" required id="ageField">
                <div id="ageError">⚠ يرجى إدخال العمر بالأرقام الإنجليزية فقط</div>
            </div>
            
            <input type="text" name="phone" placeholder="رقم الهاتف" required>
            <input type="email" name="email" placeholder="البريد الإلكتروني" required>
            <button type="button" class="btn next">التالي</button>
        </div>

        <!-- الخطوة 2 -->
        <div class="form-step">
            <select name="job" required>
                <option value="">اختر الوظيفة المطلوبة</option>
                {% for j in jobs %}
                <option value="{{ j }}">{{ j }}</option>
                {% endfor %}
            </select>
            <input type="text" name="school" placeholder="المدرسة" required>
            <input type="text" name="university" placeholder="الجامعة" required>
            <input type="text" name="major" placeholder="التخصص" required>
            <button type="button" class="btn prev">السابق</button>
            <button type="button" class="btn next">التالي</button>
        </div>

        <!-- الخطوة 3 -->
        <div class="form-step">
            <select name="city" required>
                <option value="">اختر المدينة</option>
                {% for c in cities %}
                <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
            </select>
            <input type="text" name="address" placeholder="عنوان السكن" required>
            <textarea name="experience" placeholder="الخبرات" required></textarea>
            <textarea name="references" placeholder="المعرفون"></textarea>
            <button type="button" class="btn prev">السابق</button>
            <button type="submit" class="btn submit">إرسال</button>
        </div>
    </form>
    {% endif %}
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    // Loading Screen
    setTimeout(() => {
        document.getElementById("loadingScreen").style.display = "none";
        const form = document.getElementById("formContainer");
        form.style.display = "block";
        form.classList.add("fade-in");
    }, 1200); // مدة التحميل
});

// Multi-step form
const prevBtns = document.querySelectorAll(".prev");
const nextBtns = document.querySelectorAll(".next");
const progress = document.getElementById("progress");
const formSteps = document.querySelectorAll(".form-step");
const progressSteps = document.querySelectorAll(".progress-step");
let formStepsNum = 0;

nextBtns.forEach(btn => {
    btn.addEventListener("click", () => {
        const currentStep = formSteps[formStepsNum];
        const requiredFields = currentStep.querySelectorAll("[required]");
        let allFilled = true;
        requiredFields.forEach(field => {
            if (!field.value) allFilled = false;
        });
        if(!allFilled) {
            alert("يرجى ملء جميع الحقول المطلوبة قبل الانتقال للخطوة التالية.");
            return;
        }
        formStepsNum++;
        updateFormSteps();
        updateProgressbar();
    });
});

prevBtns.forEach(btn => {
    btn.addEventListener("click", () => {
        formStepsNum--;
        updateFormSteps();
        updateProgressbar();
    });
});

function updateFormSteps() {
    formSteps.forEach((formStep, index) => {
        formStep.classList.toggle("active", index === formStepsNum);
    });
}

function updateProgressbar() {
    progressSteps.forEach((step, index) => {
        step.classList.toggle("active", index <= formStepsNum);
    });
    let completedSteps = formStepsNum;
    const totalSteps = progressSteps.length - 1;
    progress.style.width = (completedSteps / totalSteps) * 100 + "%";
}

// ✅ التحقق من حقل العمر
document.getElementById("multiStepForm").addEventListener("submit", function(e) {
    let ageField = document.getElementById("ageField");
    let errorMsg = document.getElementById("ageError");

    if (/[٠-٩]/.test(ageField.value)) { // إذا دخل أرقام عربية
        e.preventDefault(); 
        errorMsg.style.display = "block";
        ageField.focus();
    } else {
        errorMsg.style.display = "none";
    }
});
</script>
</body>
</html>
